<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Creator - Automated Pipeline</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>ğŸ¬ Video Creator</h1>
            <p class="subtitle">Automated video generation from documents</p>
        </header>

        <main>
            <!-- Login Setup -->
            <section class="card">
                <h2>ğŸ” Login Setup</h2>
                <p style="margin-bottom: 1rem; color: var(--text-muted);">
                    First time? Click "Setup Login" to log into all services. Your sessions will be saved.
                </p>
                <div class="input-group">
                    <button onclick="setupLogin()" class="btn btn-primary" id="loginBtn">
                        ğŸ” Setup Login
                    </button>
                    <button onclick="verifySessions()" class="btn btn-secondary" id="verifyBtn">
                        âœ“ Verify Sessions
                    </button>
                    <button onclick="testPerplexity()" class="btn btn-success" id="testPerplexityBtn">
                        ğŸ§ª Test Perplexity
                    </button>
                    <span id="sessionStatus" class="session-status">Not verified</span>
                </div>
                <div id="testResults" style="margin-top: 1rem; display: none;">
                    <p style="color: var(--text-muted); font-size: 0.9rem;" id="testMessage"></p>
                </div>
            </section>

            <!-- Step 1: Select Document Folder -->
            <section class="card">
                <h2>ğŸ“ Step 1: Select Document Folder</h2>
                <div class="input-group" style="flex-wrap: wrap; gap: 0.5rem;">
                    <button onclick="selectLocalFolder()" class="btn btn-primary" id="selectFolderBtn"
                        style="font-size: 1.1rem; padding: 0.75rem 1.5rem;">
                        ğŸ“‚ Add Folder
                    </button>
                    <button onclick="clearLocalFolders()" class="btn btn-secondary">
                        ğŸ—‘ï¸ Clear All
                    </button>
                    <div id="folderPath" class="folder-name"
                        style="flex: 1; min-width: 200px; padding: 0.5rem; background: var(--bg); border-radius: 0.25rem;">
                        No
                        folder selected</div>
                </div>
                <small class="hint" style="display: block; margin-top: 0.5rem;">Output will be saved to: <strong
                        id="outputPathPreview">[Selected Folder]/output/</strong></small>

                <div id="documentList" class="document-list" style="margin-top: 1rem;"></div>
            </section>

            <!-- Step 2: Configure Settings -->
            <section class="card">
                <h2>âš™ï¸ Step 2: Configure Video Settings</h2>

                <div class="form-group">
                    <label for="perplexityChatUrl">Perplexity Chat URL (Optional)</label>
                    <input type="text" id="perplexityChatUrl" placeholder="https://www.perplexity.ai/search/...">
                    <small class="hint">If you have an existing Perplexity chat with the prompt, paste the URL
                        here</small>
                </div>

                <div class="form-group">
                    <label for="promptText">Or Enter Prompt Text Directly</label>
                    <textarea id="promptText" rows="4"
                        placeholder="Enter your video generation prompt here..."></textarea>
                    <small class="hint">This will be used if no Perplexity URL is provided</small>
                </div>

                <div class="form-group">
                    <label for="notebookLmChatSettings">NotebookLM Chat Settings</label>
                    <textarea id="notebookLmChatSettings" rows="3"
                        placeholder="Focus on key concepts and provide clear explanations...">Focus on key concepts and provide clear explanations</textarea>
                </div>

                <div class="form-group">
                    <label for="notebookLmStyleSettings">NotebookLM Style Settings</label>
                    <textarea id="notebookLmStyleSettings" rows="3"
                        placeholder="Modern, engaging, educational style">Modern, engaging, educational style</textarea>
                </div>

                <div class="form-group">
                    <label for="stylePrompt">Gemini Video Style Prompt</label>
                    <textarea id="stylePrompt" rows="3"
                        placeholder="Professional with smooth transitions">Professional with smooth transitions</textarea>
                </div>

                <div class="form-group">
                    <label for="sourceFolder">Local Source Folder Path (Absolute)</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="sourceFolder" placeholder="e.g. F:\MyWork\Docs" style="flex: 1;">
                        <button type="button" onclick="browseFolder()" class="btn btn-secondary"
                            style="white-space: nowrap; padding: 0.5rem 1rem;">ğŸ“‚ Browse</button>
                    </div>
                    <small class="hint">If set, files will be read from here and output saved to 'output'
                        subfolder.</small>
                </div>

                <div class="form-group">
                    <label for="outputDir">Output Directory Override (Optional)</label>
                    <input type="text" id="outputDir" placeholder="Leave empty to use source folder's output">
                </div>

                <div class="form-group" style="flex-direction: row; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="headlessMode" style="width: auto; margin: 0;">
                    <label for="headlessMode" style="margin: 0; cursor: pointer;">Start Browser Minimized</label>
                </div>

                <div class="form-group"
                    style="flex-direction: row; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
                    <input type="checkbox" id="deleteConversation" style="width: auto; margin: 0;">
                    <label for="deleteConversation" style="margin: 0; cursor: pointer;">Delete Conversation After
                        Completion</label>
                </div>

                <div class="form-group"
                    style="flex-direction: row; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
                    <input type="checkbox" id="keepOpen" style="width: auto; margin: 0;">
                    <label for="keepOpen" style="margin: 0; cursor: pointer;">Keep Browser Open After Test</label>
                </div>

                <button onclick="saveSettings()" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                    ğŸ’¾ Save Settings
                </button>
                <p id="saveMessage"
                    style="text-align: center; margin-top: 0.5rem; color: var(--success); display: none;">
                    âœ“ Settings saved!
                </p>
            </section>

            <!-- Step 3: Generate -->
            <section class="card">
                <h2>ğŸš€ Step 3: Generate Video</h2>
                <button onclick="generateVideo()" id="generateBtn" class="btn btn-success btn-large" disabled>
                    Generate Video
                </button>
                <p class="hint">Select documents first to enable generation</p>
            </section>

            <!-- Progress Section -->
            <section class="card progress-section" id="progressSection" style="display: none;">
                <h2>ğŸ“Š Progress</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div id="progressLog" class="progress-log"></div>
            </section>

            <!-- Results Section -->
            <section class="card" id="resultsSection" style="display: none;">
                <h2>âœ… Results</h2>
                <div id="resultsContent"></div>
            </section>
        </main>

        <footer>
            <p>Status: <span id="status" class="status-idle">Idle</span></p>
        </footer>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="app.js"></script>
</body>

</html>